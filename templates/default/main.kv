#:kivy 1.8.0
#:import ListAdapter kivy.adapters.listadapter.ListAdapter
#:import Factory kivy.factory.Factory

<VentureItem>:
    key: root.key
    orientation: "horizontal"
    size_hint: 1, None
    height: "120dp"
    BoxLayout:
        orientation: "vertical"
        size_hint: 0.3, 1
        Image:
            source: "templates/default/assets/coffee.png"
            size_hint: None, 1.0
            halign: "left"
            size: self.width, self.height
        Label:
            text: "BUY" if not root.key == 0 and int(root.cash) >= int(root.cost) else ""
            text_size: self.width, None
            pos_hint: {'x': .30}
            color: 0, .737, 1, 1,
            bold: True
    BoxLayout:
        orientation: "vertical"
        Label:
            text: root.name
            text_size: self.width, None
        BoxLayout:
            orientation: "horizontal"
            BoxLayout:
                orientation: "vertical"
                Label:
                    text: "OWNED"
                    text_size: self.width, None
                    font_size: "12px"
                Label:
                    text: "COST"
                    text_size: self.width, None
                    font_size: "12px"
                Label:
                    text: "TIME LEFT"
                    text_size: self.width, None
                    font_size: "12px"

            BoxLayout:
                orientation: "vertical"
                Label:
                    text: ": %s" % str(root.owned)
                    text_size: self.width, None
                    font_size: "12px"
                Label:
                    text: ": $ %s" % str(root.cost)
                    text_size: self.width, None
                    font_size: "12px"
                Label:
                    text: ": %s" % str(root.timeleft)
                    text_size: self.width, None
                    font_size: "12px"
        BoxLayout:
            padding: [10,10,10,10]
            canvas.before:
                Color:
                    rgb: .0, .0, .0
                Rectangle:
                    pos: self.pos[0], self.pos[1] + 10
                    size: self.size[0], self.size[1] - 25
            canvas:
                Color:
                    rgb: .717, .109, .109
                Rectangle:
                    pos: self.pos[0], self.pos[1] + 10
                    size: 0 if root.owned == 0 else (self.size[0] / root.period) * (root.tdiff if root.tdiff > 0 else 1) , self.size[1] - 25
            Label:
                id: revenue
                color: 1.0, 1.0, 1.0, 1
                text: "$ %s" % (str(root.revenue) if root.owned else "0.00")
                size_hint: 1.0, 1.0
                halign: "right"
                text_size: self.width, self.height
        #ProgressBar:
        #    max: root.period
        #    value: root.tdiff
        #    size_hint: .9, 1
        #    size: self.width, "50dp"
        #    color: .717, .109, .109, 1

<Main>:
    rows: 3
    row_default_height: "25dp"
    sm:sm #screen manager
    cash: cash
    ventureList: ventureList

    canvas.before:
        Color:
            rgb: .133, .133, .133
        Rectangle:
            size: self.size


    BoxLayout:
        orientation: "vertical"
        height: "70dp"
        size_hint: 1, None
        BoxLayout:
            orientation: "horizontal"
            Image:
                source: "templates/default/assets/crown.png"
                size_hint: None, 1.0
                halign: "left"
                padding: "20dp"
            Label:
                text: "IDLE VENTURE CAPITAL"
                bold: True
                color: .333, .545, .184, 1
                size_hint: 1, None
                halign: "left"
                valign: "bottom"
                text_size: self.width, self.height
                font_size: "20dp"
        BoxLayout:
            padding: [10,10,10,10]
            canvas.before:
                Color:
                    rgb: .333, .545, .184
                Rectangle:
                    pos: self.pos[0], self.pos[1] + 5
                    size: self.size[0], self.size[1] - 10
            Label:
                id: cash
                bold: True
                color: .133, .133, .133, 1
                text: "$ CASH"
                size_hint: 1.0, 1.0
                halign: "right"
                text_size: self.width, self.height

    ScreenManager:
        id: sm

        Screen:
            name: "ventures"
            scroll_x: False
            scroll_y: True

            ListView:
                id: ventureList
                adapter:
                    ListAdapter(data=root.ventures, cls=Factory.VentureItem, args_converter=root.args_converter)

    GridLayout:
        cols: 4
        size_hint: 1, 0
        MenuToggleButton:
            identity: "ventures"
            size_hint_y: None
            height: "48dp"
            text: "Ventures"
            group: "menu"
            state: "down"

        MenuToggleButton:
            identity: "store"
            size_hint_y: None
            height: "48dp"
            text: "Store"
            group: "menu"

        MenuToggleButton:
            identity: "achievements"
            size_hint_y: None
            height: "48dp"
            text: "Achieve"
            group: "menu"

        MenuToggleButton:
            identity: "settings"
            size_hint_y: None
            height: "48dp"
            text: "Settings"
            group: "menu"